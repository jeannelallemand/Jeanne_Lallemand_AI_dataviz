<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI tools visualizer</title>
    <script src="https://d3js.org/d3.v7.js"></script>
    <style>
        @font-face {
            font-family: 'PowerGroteskTrial-Bold';
            src: url('/PowerGroteskTrial-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'PowerGroteskTrial-Regular';
            src: url('/PowerGroteskTrial-Regular.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        .svg-container {
            position: relative;
        }

        body {
            background-color: #FFFBEC;
            font-family: 'PowerGroteskTrial-Regular', sans-serif;
            font-size: 30;
            margin: 0;
            padding: 0;
        }

        text {
            user-select: none;
            pointer-events: none;
        }

        .title {
            font-family: 'PowerGroteskTrial-Bold', sans-serif;
        }

        #svg1 {
            user-select: none;
            pointer-events: none;
        }

        .isCategory {
            opacity: 0;
        }

        .textBox {
            text-anchor: middle;
            font-size: 6px;
            user-select: none;
            pointer-events: none;
        }

        line {
            stroke-width: 1;
        }
    </style>
</head>

<body>
    <div class="svg-container">
        <script>
            d3.json("./aitools.json").then(function (data) {
                var height = window.innerHeight
                var widthTotal = window.innerWidth
                var width = widthTotal * 13 / 10
                var widthG1 = widthTotal * 3 / 10
                var widthBarChart = widthTotal

                var svg = d3.select(".svg-container")
                    .append("svg")
                    .attr("width", widthTotal)
                    .attr("height", height)
                    .style("position", "absolute")

                var svg1 = d3.select(".svg-container")
                    .append("svg")
                    .attr("width", widthTotal)
                    .attr("height", height)
                    .attr("id", "svg1")

                var canvas = d3.select(".svg-container")
                    .append("svg")
                    .attr("width", widthBarChart)
                    .attr("height", height)
                    .style("background-color", "#FFFBEC")

                //..........INTRODUCTION TEXT ON THE SIDE...............          
                function Introtext() {

                    svg1.append("rect")
                        .attr("x", 0)
                        .attr("y", 0)
                        .attr("width", widthG1)
                        .attr("height", height)
                        .attr("fill", "#3E9E66");

                    var text_placement = widthTotal * 2 / 5 * 0.04
                    var text_height = height * 4 / 7

                    var title = svg1.append("text")
                        .attr("x", text_placement)
                        .attr("y", text_height)
                        .style("fill", "#FFFBEC");

                    title.append("tspan")
                        .text("AI tools")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.18)
                        .attr("class", "title")
                        .attr("dy", 0);

                    title.append("tspan")
                        .text("visualizer")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.18)
                        .attr("class", "title")
                        .attr("dy", "1.1em");

                    title.append("tspan")
                        .text("This data visualization represents ")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "3em");

                    title.append("tspan")
                        .text("AI tools associated to their domain ")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    title.append("tspan")
                        .text("of use. Each dot represents a specific")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    title.append("tspan")
                        .text("tool and is linked to its associated")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    title.append("tspan")
                        .text("category and subcategory.")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    svg1.append("text")
                        .text("Author: Jeanne Lallemand")
                        .attr("x", text_placement)
                        .attr("y", height / 13)
                        .style("font-size", widthG1 * 0.04)
                        .style("fill", "#FFFBEC")

                       svg1.append("text")
                        .text("Source: https://www.kaggle.com/datasets/yasirabdaali/740-ai-tools-for-everyone ")
                        .attr("x", text_placement)
                        .attr("y", height / 13 +13)
                        .style("font-size", widthG1 * 0.02)
                        .style("fill", "#FFFBEC");

                    svg1.append("path")
                        .attr("d", "M15.5 0V45M15.5 45C15.6667 40.3333 13 29.5 1 23.5M15.5 45C16.6667 37.1667 21.1 21.9 29.5 23.5")
                        .attr("transform", "translate(" + text_placement + "," + (height - 80) + ")")
                        .attr("stroke-width", 3)
                        .attr("stroke", "#FFFBEC")
                        .attr("fill", "none")
                        .attr("id", "arrow");

                    var explaination = canvas.append("text")
                        .attr("x", text_placement)
                        .attr("y", 30)
                        .style("fill", "#3E9E66");

                    explaination.append("tspan")
                        .text("Here is a bar chart showing the quantity")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    explaination.append("tspan")
                        .text("of tools in each category. A high number")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    explaination.append("tspan")
                        .text("of tools can indicate a specific demand")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    explaination.append("tspan")
                        .text("and interest in using AI for that particular")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");

                    explaination.append("tspan")
                        .text("domain of application. ")
                        .attr("x", text_placement)
                        .style("font-size", widthG1 * 0.048)
                        .attr("dy", "1em");
                }
                Introtext()

                //..........DATA VISUALIZATION................  
                function dataViz() {

                    let clicked = false;
                    let clickedCate = false;
                    let clickedTool = false;
                    var backgroundcolor = "#FFFBEC";
                    var previousElement = null;
                    var previousTool = null;
                    var newSelectionTool = null;
                    var ElementText = null;

                    var nodes = data.filter(d => d.tool);

                    var toolCategory = d3.groups(nodes, function (d) {
                        return d.category
                    });

                    var desiredCategories = [
                        { name: "Image Creation", subcategories: ["Avatar", "Motion Capture", "Text-To-Video", "Video Editing", "Generative Video", "Generative Art", "Image Improvement"] },
                        { name: "Communication", subcategories: ["Chat", "Generative Code", "Text-To-Speech", "Speech-To-Text"] },
                        { name: "Information and Learning", subcategories: ["Prompt Guides", "Translation", "AI Detection", "Image Scanning", "Research"] },
                        { name: "Media Production", subcategories: ["Podcasting", "Voice Modulation", "Music", "Gaming", "For Fun"] },
                        { name: "Personal Development", subcategories: ["Inspiration", "Self-Improvement", "Social Media"] },
                        { name: "Business and Productivity", subcategories: ["Marketing", "Productivity", "Aggregators", "Copywriting", "Finance"] }
                    ];

                    var sortCategories = desiredCategories.flatMap(category => category.subcategories);

                    var customOrder = {};
                    sortCategories.forEach((category, index) => {
                        customOrder[category] = index;
                    });

                    toolCategory.sort((a, b) => {
                        const indexA = customOrder[a[0]];
                        const indexB = customOrder[b[0]];
                        return indexA - indexB;
                    });


                    const numberOfCategory = toolCategory.length
                    const range = d3.range(0, 360, 360 / numberOfCategory)
                    var radius = 260;


                    var combinedNodes = nodes.concat(toolCategory.map(([category, tools], index) => ({
                        category: category,
                        isCategory: true,
                        id: `category_${index}`,
                    })));

                    var links = [];
                    combinedNodes.forEach((node, index) => {
                        if (node.isCategory) {
                            const associatedTools = nodes.filter(tool => tool.category === node.category);
                            associatedTools.forEach(tool => {
                                const targetIndex = combinedNodes.findIndex(n => n.tool === tool.tool);
                                if (targetIndex !== -1) {
                                    links.push({ source: node.category, target: targetIndex });
                                }
                            });
                        }
                    });

                    var linksTag = [];
                    combinedNodes.forEach((node, index) => {
                        if (node.isCategory) {
                            const associatedTools = nodes.filter(tool => tool.tags === node.category);
                            associatedTools.forEach(tool => {
                                const targetIndex = combinedNodes.findIndex(n => n.tool === tool.tool);
                                if (targetIndex !== -1) {
                                    linksTag.push({ source: node.category, target: targetIndex });
                                }
                            });
                        }
                    });

                    var backgroundClick = svg.append("g").classed("backgroundClick", true);
                    var groupLinkTags = svg.append("g").classed("linksTag", true);
                    var groupLink = svg.append("g").classed("links", true);
                    var groupCategory = svg.selectAll(".cateRect").data(combinedNodes).join("g").classed("cateRect", true);
                    var defNodes = svg.append("g").classed("nodes", true)
                    var defNodes = svg.append("g").classed("textNode", true)
                    var groupNode = svg.select(".nodes").selectAll("g").data(combinedNodes).join("g");
                    var groupText = svg.select(".textNode").selectAll("g").data(combinedNodes).join("g");

                    const customColors = ["#6575FA", "#68B06B", "#FFC278", "#B3785D", "#F26B6B", "#B670AC"];
                    const colorScale = d3.scaleOrdinal()
                        .domain(sortCategories)
                        .range(customColors);

                    //...................  SIMULATION ..................................................
                    //..................................................................................
                    var simulation = d3.forceSimulation(combinedNodes)
                        .force("charge", d3.forceManyBody().strength(3))
                        .force("center", d3.forceCenter(width / 2, height / 2))
                        .force("collision", d3.forceCollide().radius(7))
                        .on('tick', ticked)
                        .on('end', function () {
                            svg.selectAll(".isCategory")
                                .each(function (d) {
                                    categories[d.category] = { x: this.getBoundingClientRect().x, y: this.getBoundingClientRect().y }
                                })
                                .nodes().map(e => e.getBoundingClientRect())

                            svg.selectAll(".tool")
                                .each(function (d) {
                                    toolPosition[d.index] = { x: this.getBoundingClientRect().x, y: this.getBoundingClientRect().y }
                                })
                                .nodes().map(e => e.getBoundingClientRect())

                            updateLinks();
                            updateNodes();
                        });

                    const categories = {}
                    const toolPosition = {}

                    //................... UPDATE LINKS..................................................
                    //..................................................................................
                    function updateLinks() {

                        groupLinkTags
                            .selectAll("line")
                            .data(linksTag)
                            .join("line")
                            .attr("x1", function (d) {
                                return categories[d.source].x;
                            })
                            .attr("y1", function (d) {
                                return categories[d.source].y;
                            })
                            .attr("x2", function (d) {
                                if (d.isCategory) { }
                                return toolPosition[d.target].x;
                            })
                            .attr("y2", function (d) {
                                if (d.isCategory) { }
                                return toolPosition[d.target].y;
                            })
                            .style("stroke", d => {
                                const subcategory = d.source;
                                const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                                return desiredCategory ? colorScale(desiredCategory.name) : "white";
                            })
                            .style("opacity", 0);

                        groupLink
                            .selectAll("line")
                            .data(links)
                            .join("line")
                            .attr("x1", function (d) {
                                return categories[d.source].x;
                            })
                            .attr("y1", function (d) {
                                return categories[d.source].y;
                            })
                            .attr("x2", function (d) {
                                if (d.isCategory) { }
                                return toolPosition[d.target].x;
                            })
                            .attr("y2", function (d) {
                                if (d.isCategory) { }
                                return toolPosition[d.target].y;
                            })
                            .style("stroke", d => {
                                const subcategory = d.source;
                                const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                                return desiredCategory ? colorScale(desiredCategory.name) : "white";
                            })
                            .style("opacity", 0);
                    }

                    //...................... UPDATE NODES..................................................
                    //..................................................................................
                    function updateNodes() {

                        // .....................TEXT..........................
                        var size_box = 80
                        svg.append("defs")
                            .html(`<filter id="drop-shadow" x="-50%" y="-50%" width="400%" height="400%">
                                <feOffset result="offOut" in="SourceAlpha" dx="2" dy="2" />
                                <feGaussianBlur result="blurOut" in="offOut" stdDeviation="2" />
                                <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
                                </filter>`);


                        groupText.selectAll("rect")
                            .data(d => [d])
                            .join("rect")
                            .filter(d => !d.isCategory)
                            .classed("textBox", true)
                            .attr("x", d => d.x - (d.tool.length * 8.5 / 2))
                            .attr("y", d => d.y + 15)
                            .attr("width", function (d) {
                                var textWidth = d.tool.length;
                                return textWidth * 8.5;
                               
                            })
                            .attr("height", 32)
                            .attr("rx", 10)
                            .attr("ry", 10)
                            .attr("fill", "#FFFDF5")
                            .attr("stroke", "none")
                            .style("opacity", 0)
                            .style("filter", "url(#drop-shadow)");

                        groupText.selectAll("text")
                            .data(d => [d])
                            .join("text")
                            .text(function (d) {
                                return d.isCategory ? d.category : d.tool;
                            })
                            .attr("x", d => d.isCategory ? 0 : d.x)
                            .attr("y", d => d.isCategory ? 0 : d.y + 34)
                            .attr("transform", function (d) {
                                if (d.isCategory) {
                                    var cateNumber = d.index - nodes.length;
                                    var transformation = "translate(" + width / 2 + "," + height / 2 + ")" +
                                        "rotate(" + range[cateNumber] + ")" +
                                        "translate(" + (radius + 60) + ", 0)";
                                    if (range[cateNumber] > 90 && range[cateNumber] < 270) {
                                        transformation += "rotate(180)";
                                    }
                                    return transformation;
                                }
                            })
                            .attr("class", d => d.isCategory ? "categoryText" : "toolText")
                            .style("font-size", d => d.isCategory ? 13 : 14)
                            .attr("opacity", d => d.isCategory ? 1 : 0)
                            .style("text-anchor", d => d.isCategory ? "middle" : "middle")


                        groupNode.selectAll("circle")
                            .data(d => [d])
                            .join("circle")
                            .attr("class", d => d.isCategory ? "isCategory" : "tool")
                            .attr("r", d => d.isCategory ? 1 : 3)
                            .attr("cx", d => d.isCategory ? 0 : d.x)
                            .attr("cy", d => d.isCategory ? 0 : d.y)
                            .attr("transform", function (d) {
                                if (d.isCategory) {
                                    var cateNumber = d.index - nodes.length;
                                    return "translate(" + width / 2 + "," + height / 2 + ")" +
                                        "rotate(" + range[cateNumber] + ")" +
                                        "translate(" + radius + ", 0)";
                                }
                            })
                            .attr("fill", d => {
                                const subcategory = d.category;
                                const desiredCategory = desiredCategories.find(
                                    category => category.subcategories.includes(subcategory));
                                return desiredCategory ? colorScale(desiredCategory.name) : "none";
                            })
                            .style("stroke", d => {
                                const subcategory = d.tags;
                                const desiredCategory = desiredCategories.find(
                                    category => category.subcategories.includes(subcategory));
                                return desiredCategory ? colorScale(desiredCategory.name) : "none";
                            })
                            .style("stroke-width", d => d.isCategory ? 0 : 2)
                            .attr("opacity", 1)


                            // ........................ON MOUSE OVER TOOLS .............................................
                            //.......................................................................................
                            .on("mouseover", function (event, d) {
                                if (clicked === false) {
                                    if (clickedTool === false) {
                                        //bigger nodes for the selected object
                                        d3.selectAll(".tool").attr("r", 2).style("opacity", 0.2);
                                        d3.select(this).attr("r", 7).style("opacity", d => d.isCategory ? 0 : 1).style("stroke-width", 4);

                                        //show associated link
                                        d3.selectAll(".linksTag line")
                                            .style("opacity", linksTag => linksTag.target === d.index ? 0.8 : 0);
                                        d3.selectAll(".links line")
                                            .style("opacity", link => link.target === d.index ? 0.8 : 0);

                                        //Text tool
                                        svg.selectAll(".toolText")
                                            .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0);
                                        svg.selectAll(".textBox")
                                            .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0);

                                        //Associated category
                                        svg.selectAll(".newCategory")
                                            .style("opacity", 0.2);
                                        svg.selectAll(".newCategory")
                                            .filter(category => category.category === d.category || category.category === d.tags)
                                            .style("opacity", 1);

                                        d3.selectAll(".categoryText")
                                            .style("opacity", 0.2)
                                        d3.selectAll(".categoryText")
                                            .filter(category => category.category === d.category || category.category === d.tags)
                                            .style("opacity", 1)
                                    } else {
                                        d3.selectAll(".tool").attr("r", 2).style("opacity", 0.2);
                                        d3.select(this).attr("r", 7).style("opacity", d => d.isCategory ? 0 : 1).style("stroke-width", 4);
                                        d3.select(previousTool).attr("r", 7).style("opacity", d => d.isCategory ? 0 : 1).style("stroke-width", 4);
                                        newSelectionTool = this;
                                    }
                                }
                            })

                            .on("mouseout", function () {
                                if (clicked === false) {
                                    if (clickedTool === false) {
                                        svg.selectAll(".newCategory").style("opacity", 1)
                                        d3.selectAll(".linksTag line").style("opacity", 0);
                                        d3.selectAll(".links line").style("opacity", 0);
                                        d3.selectAll(".categoryText").style("opacity", 1)
                                        svg.selectAll(".toolText").style("opacity", 0)
                                        svg.selectAll(".textBox").style("opacity", 0)
                                        svg.selectAll(".tool").attr("r", 3).style("opacity", 1).style("stroke-width", 2);
                                        svg.selectAll(".isCategory").attr("r", 1).style("opacity", 0);
                                    } else {
                                        d3.selectAll(".tool").attr("r", 2).style("opacity", 0.2);
                                        d3.select(previousTool).attr("r", 7).style("opacity", d => d.isCategory ? 0 : 1).style("stroke-width", 4);
                                        svg.selectAll(".isCategory").attr("r", 1).style("opacity", 0);
                                    }
                                }

                            })

                            .on("click", function (event, d) {
                                clickedTool = true
                                clicked = false
                                previousTool = this
                                previousElement = null

                                if (clickedTool === true) {
                                    //bigger nodes for the selected object
                                    d3.selectAll(".tool").attr("r", 2).style("opacity", 0.2);
                                    d3.select(this).attr("r", 7).style("opacity", d => d.isCategory ? 0 : 1).style("stroke-width", 4);

                                    //show associated link
                                    d3.selectAll(".linksTag line")
                                        .style("opacity", linksTag => linksTag.target === d.index ?  0.8 : 0);
                                    d3.selectAll(".links line")
                                        .style("opacity", link => link.target === d.index ? 0.8 : 0);

                                    //Text tool
                                    svg.selectAll(".toolText")
                                        .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0);
                                    svg.selectAll(".textBox")
                                        .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0);

                                    //Associated category
                                    svg.selectAll(".newCategory")
                                        .style("opacity", 0.2);
                                    svg.selectAll(".newCategory")
                                        .filter(category => category.category === d.category || category.category === d.tags)
                                        .style("opacity", 1);

                                    d3.selectAll(".categoryText")
                                        .style("opacity", 0.2)
                                    d3.selectAll(".categoryText")
                                        .filter(category => category.category === d.category || category.category === d.tags)
                                        .style("opacity", 1)

                                }

                            })


                    }

                    //...................... BACKGROUND CATEGORIES..................................................
                    //..................................................................................

                    var v = svg.select(".cateRect")
                        .selectAll("g")
                        .data(combinedNodes)
                        .join("g");

                    v.selectAll("path")
                        .data(d => [d])
                        .join("path")
                        .attr("class", d => d.isCategory ? "newCategory" : "newtool")
                        .attr("d", function (d) {
                            if (d.isCategory) {
                                var trapezoidWidth = 40;
                                var trapezoidHeight = 124;
                                var pathData = `
                                 M ${-trapezoidHeight / 2} ${-trapezoidWidth / 1.5}
                                 L ${-trapezoidHeight / 2} ${trapezoidWidth / 1.5}
                                 L ${trapezoidHeight / 2} ${trapezoidWidth}
                                 L ${trapezoidHeight / 2} ${-trapezoidWidth}
                                 Z`;
                                return pathData;
                            }
                        })
                        .attr("transform", function (d) {
                            if (d.isCategory) {
                                var cateNumber = d.index - nodes.length;
                                return "translate(" + width / 2 + "," + height / 2 + ")"
                                    + "rotate(" + range[cateNumber] + ")"
                                    + "translate(" + (radius + 60) + ", 0)";
                            }
                        })
                        .attr("fill", d => {
                            const subcategory = d.category;
                            const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                            return desiredCategory ? colorScale(desiredCategory.name) : "white"; 
                        })
                        .attr("opacity", 1)

                        // ........................ON MOUSE OVER CATEGORY .............................................
                        //............................................................................................. 
                        .on("mouseover", function (event, d) {
                            if (clicked === false) {
                                if (clickedTool === false) {
                                    svg.selectAll(".newCategory").style("opacity", 0.2)
                                    d3.select(this).style("opacity", 1)

                                    d3.selectAll(".linksTag line")
                                        .style("opacity", linksTag => linksTag.source === d.category ? 0.8 : 0);
                                    d3.selectAll(".links line")
                                        .style("opacity", link => link.source === d.category ? 0.8 : 0);


                                    d3.selectAll(".categoryText")
                                        .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0.2)
                                        .style("fonte-size", 20);


                                    d3.selectAll(".tool").attr("r", 3).style("opacity", 0.2).style("stroke-width", 2);
                                    d3.selectAll(".tool")
                                        .filter(tool => tool.category === d.category || tool.tags === d.category)
                                        .attr("r", 7)
                                        .style("opacity", 1)
                                        .style("stroke-width", 4);

                                    d3.selectAll(".toolText").style("opacity", 0)
                                    d3.selectAll(".textBox").style("opacity", 0)
                                }
                            }
                            if (clickedTool === false) {
                                svg.selectAll("path").style("opacity", 0.2)
                                d3.select(this).style("opacity", 1)
                                d3.select(previousElement).style("opacity", 1)


                            }

                        })

                        .on("mouseout", function () {
                            if (clicked === false) {
                                if (clickedTool === false) {
                                    svg.selectAll(".newCategory").style("opacity", 1)
                                    svg.selectAll(".linksTag line").style("opacity", 0); 
                                    svg.selectAll(".links line").style("opacity", 0);
                                    d3.selectAll(".categoryText").style("opacity", 1)
                                    d3.selectAll(".toolText").style("opacity", 0)
                                    d3.selectAll(".textBox").style("opacity", 0)
                                    d3.selectAll(".tool").attr("r", 3).style("opacity", 1).style("stroke-width", 2);
                                    d3.selectAll(".isCategory").attr("r", 1).style("opacity", 0);
                                }
                            }
                            if (clickedTool === false) {
                                d3.select(this).style("opacity", 1)
                            }
                        })

                        .on("click", function (event, d) {
                            clicked = true
                            clickedTool = false
                            previousElement = this
                            previousTool = null

                            if (clicked) {
                                d3.selectAll(".newCategory").style("opacity", 0.2)
                                d3.select(this).style("opacity", 1)
                                svg.selectAll(".linksTag line")
                                    .style("opacity", linksTag => linksTag.source === d.category ? 0.8 : 0);
                                svg.selectAll(".links line")
                                    .style("opacity", link => link.source === d.category ? 0.8 : 0);
                                d3.selectAll(".categoryText")
                                    .style("opacity", combinedNodes => combinedNodes.index === d.index ? 1 : 0.2)
                                    .style("fonte-size", 20);
                                d3.selectAll(".tool").attr("r", 3).style("opacity", 0.2).style("stroke-width", 2);
                                d3.selectAll(".tool")
                                    .filter(tool => tool.category === d.category || tool.tags === d.category)
                                    .attr("r", 7)
                                    .style("opacity", 1)
                                    .style("stroke-width", 4);
                                d3.selectAll(".toolText").style("opacity", 0)
                                d3.selectAll(".textBox").style("opacity", 0)

                            }
                        })

                    backgroundClick
                        .append("rect")
                        .attr("x", 0)
                        .attr("y", 0)
                        .attr("width", width)
                        .attr("height", height)
                        .style("fill", backgroundcolor)
                        .style("opacity", 0.1)
                        .on("click", function () {
                            clicked = false
                            clickedTool = false
                            previousElement = null
                            previousTool = null

                            svg.selectAll(".newCategory").style("opacity", 1)
                            svg.selectAll(".linksTag line").style("opacity", 0); 
                            svg.selectAll(".links line").style("opacity", 0);
                            d3.selectAll(".categoryText").style("opacity", 1)
                            d3.selectAll(".toolText").style("opacity", 0)
                            d3.selectAll(".textBox").style("opacity", 0)
                            d3.selectAll(".tool").attr("r", 3).style("opacity", 1).style("stroke-width", 2);
                            d3.selectAll(".isCategory").attr("r", 5).style("opacity", 0);
                        })

                    //arrow click
                    svg.append("rect")
                        .attr("x", 0)
                        .attr("y", 0)
                        .attr("width", 40)
                        .attr("height", 50)
                        .attr("transform", "translate(20," + (height - 80) + ")")
                        .attr("fill", "black")
                        .style("opacity", 0)
                        .on("click", function () {
                            window.scrollTo({
                                top: document.body.scrollHeight,
                                behavior: "smooth"
                            });
                        });

                    function ticked() {
                        updateNodes();
                    }

                    function barChart() {

                        var margin = 100

                        var tags = ['', 'Marketing', 'Self-Improvement', 'Prompt Guides', 'Video Editing', 'Generative Video', 'Text-To-Speech', 'Voice Modulation', 'Inspiration', 'Speech-To-Text', 'Podcasting', 'Generative Code', "Matt's Picks", 'Image Improvement', 'Text-To-Video', 'Productivity', 'For Fun', 'Research', 'Music', 'Chat', 'Social Media', 'Image Scanning', 'Gaming', 'AI Detection', 'Translation', 'Avatar', 'Finance', 'Generative Art', 'Copywriting']

                        var referenceLines = canvas.selectAll(".reference-line")
                            .data([30, 60, 90, 120])
                            .enter()
                            .append("line")
                            .attr("class", "reference-line")
                            .attr("x1", margin)
                            .attr("y1", function (d) { return height * 0.83 - d * 3.5; })
                            .attr("x2", widthTotal - margin)
                            .attr("y2", function (d) { return height * 0.83 - d * 3.5; })
                            .attr("stroke", "gray")
                            .attr("stroke-width", 1)
                            .attr("stroke-dasharray", "4");

                        canvas.selectAll(".numberText")
                            .data([30, 60, 90, 120])
                            .enter()
                            .append("text")
                            .attr("class", "numberText")
                            .attr('text-anchor', 'end')
                            .text(function (d) { return d; })
                            .attr("x", margin - 8)
                            .attr("y", function (d) { return height * 0.83 - d * 3.5; })
                            .attr("fill", "gray")

                        toolCategory.forEach((category, n) => {
                            var nameCategory = data.filter(e => e.category === category[0])
                            var lengthData = nameCategory.length
                            var nameTags = data.filter(e => e.tags === category[0])
                            var lengthTags = nameTags.length
                         

                            var widthBar = ((widthBarChart - margin * 2) / toolCategory.length) - 10
                            //categories
                            canvas.append("rect")
                                .attr("class", "bar")
                                .attr("x", margin + ((widthBarChart - margin * 2) / toolCategory.length) * n)
                                .attr("height", lengthData * 3.5)
                                .attr("y", (height * 0.83) - lengthData * 3.5)
                                .attr("width", widthBar)
                                .attr("fill", d => {
                                    const subcategory = category[0];
                                    const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                                    return desiredCategory ? colorScale(desiredCategory.name) : "white"; 
                                })
                                .on("mouseover", function (event, d) {
                                    var textID = "text_" + n;
                                    canvas.select("#" + textID)
                                        .style("opacity", 1);
                                })
                                .on("mouseout", function () {
                                    canvas.selectAll(".numberTools").style("opacity", 0)
                                });

                            //tags that have the same catgeory
                            canvas.append("rect")
                                .attr("class", "bar")
                                .attr("x", margin + ((widthBarChart - margin * 2) / toolCategory.length) * n)
                                .attr("height", lengthTags * 3.5)
                                .attr("y", (height * 0.83) - lengthData * 3.5 - lengthTags * 3.5)
                                .attr("width", widthBar)
                                .attr("fill", d => {
                                    const subcategory = category[0];
                                    const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                                    return desiredCategory ? colorScale(desiredCategory.name) : "white"; 
                                })
                                .style("opacity", 0.6)
                                .on("mouseover", function (event, d) {
                                    var textID = "text_" + n;
                                    canvas.select("#" + textID)
                                        .style("opacity", 1);
                                })
                                .on("mouseout", function () {
                                    canvas.selectAll(".numberTools").style("opacity", 0)
                                });

                            canvas.append("text")
                                .attr("class", "numberTools")
                                .attr("id", "text_" + n)
                                .html(lengthData + lengthTags)
                                .attr("x", margin + ((widthBarChart - margin * 2) / toolCategory.length) * n + (widthBar / 2))
                                .attr("y", (height * 0.83) - lengthData * 3.5 - lengthTags * 3.5 - 3)
                                .style("text-anchor", "middle")
                                .attr("fill", "grey")
                                .style("opacity", 0)



                            var textGroup = canvas.selectAll(".text-group")
                                .data(toolCategory)
                                .enter()
                                .append("g")
                                .attr("class", "text-group");

                            textGroup.append("text")
                                .text(function (d) { return d[0]; })
                                .attr("class", "text")
                                .style("align-item", "right")
                                .style("padding-bottom", "10px")
                                .attr("x", function (d, i) {
                                    return margin + ((widthBarChart - margin * 2) / toolCategory.length) * i + (widthBar / 2);
                                })
                                .attr("height", 30)
                                .style("writing-mode", "vertical-rl")
                                .attr("y", height * 0.83 + 10)
                                .attr("width", 10)
                                .attr("fill", d => {
                                    const subcategory = d[0];
                                    const desiredCategory = desiredCategories.find(category => category.subcategories.includes(subcategory));
                                    return desiredCategory ? colorScale(desiredCategory.name) : "white";
                                })
                                .attr("transform", function (d, i) {
                                    var x = margin + ((widthBarChart - margin * 2) / toolCategory.length) * i + (widthBar / 2);
                                    var y = height * 0.83 + 10;
                                    return "rotate(-40, " + x + "," + y + ")";
                                });

                        })
                    }



                    barChart()
                }
                dataViz()
            })
        </script>
    </div>

</body>
</body>

</html>